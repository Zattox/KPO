# Отчет по контрольной работе №1: Паттерны проектирования

## Общая идея решения

Проект представляет собой консольное приложение `BankHSE`, реализующее модуль «Учет финансов» для ВШЭ-банка. Основной упор сделан на управление личными финансами через создание, редактирование и удаление счетов (`BankAccount`), категорий (`Category`) и операций (`Operation`). Дополнительно реализованы аналитика, импорт/экспорт данных в форматах JSON, CSV, YAML, пересчет баланса и измерение времени выполнения команд.

Функционал полностью соответствует основным требованиям задания и расширяет опциональные возможности:
- **Аналитика**: подсчет разницы доходов/расходов, группировка по категориям, топ категорий по сумме, средняя сумма операций по категории.
- **Импорт/экспорт**: поддержка JSON, CSV, YAML через стратегии.
- **Управление данными**: пересчет баланса счета на основе операций.
- **Статистика**: измерение времени выполнения команд.

Проект структурирован по принципам SOLID и GRASP, с использованием паттернов GoF для обеспечения модульности, тестируемости и расширяемости.

## Реализованные принципы SOLID и GRASP

### SOLID
1. **Single Responsibility Principle (SRP)**:
    - Каждый класс отвечает за одну задачу:
        - `BankAccountFacade`, `CategoryFacade`, `OperationFacade` — управление соответствующими сущностями.
        - `AnalyticsService` — только аналитика.
        - `ExportContext` и `ImportContext` — управление стратегиями экспорта/импорта.
2. **Open/Closed Principle (OCP)**:
    - Код открыт для расширения, но закрыт для модификации:
        - Новые стратегии экспорта/импорта добавляются через интерфейсы `IExportStrategy` и `IImportStrategy` без изменения `ExportContext`/`ImportContext`.
3. **Liskov Substitution Principle (LSP)**:
    - Классы-наследники (`JsonExportStrategy`, `CsvExportStrategy`, `YamlExportStrategy`) взаимозаменяемы в `ExportContext`.
4. **Interface Segregation Principle (ISP)**:
    - Интерфейсы узкоспециализированы:
        - `IExportStrategy`, `IImportStrategy`, `ICoreEntityVisitor` содержат только необходимые методы.
5. **Dependency Inversion Principle (DIP)**:
    - Зависимости инвертированы через DI-контейнер в `Program.cs` и интерфейсы (`IRepository<T>`, `ICommand`).

### GRASP
1. **High Cohesion**:
    - Классы имеют высокую связность внутри модуля:
        - `BankAccountFacade` объединяет всю логику работы со счетами.
        - `CoreEntitiesAggregator` собирает данные для экспорта.
2. **Low Coupling**:
    - Низкая связанность между модулями:
        - Фасады зависят только от репозиториев и фабрик через интерфейсы.
        - Стратегии экспорта/импорта независимы друг от друга и подключаются через контекст.

## Реализованные паттерны GoF

1. **Фасад (Facade)**:
    - **Где**: `BankAccountFacade`, `CategoryFacade`, `OperationFacade`, `AnalyticsService`.
    - **Важность**: Упрощает взаимодействие с подсистемой, скрывая сложность работы с репозиториями и сущностями. Например, `BankAccountFacade.CreateAccount` инкапсулирует создание и добавление счета.
2. **Команда (Command)**:
    - **Где**: `CreateBankAccountCommand`, `CreateCategoryCommand`, `CreateOperationCommand`.
    - **Важность**: Позволяет инкапсулировать пользовательские действия как объекты, упрощая их выполнение и декорирование (например, для замера времени).
3. **Декоратор (Decorator)**:
    - **Где**: `TimingCommand`.
    - **Важность**: Добавляет функциональность замера времени выполнения команд без изменения их кода. Используется для всех команд через `CommandFactory`.
4. **Шаблонный метод (Template Method)**:
    - **Где**: `Exporter` (абстрактный класс), `Importer`.
    - **Важность**: Определяет общий алгоритм экспорта/импорта (открытие файла, форматирование/парсинг, запись), оставляя специфичные шаги (форматирование/парсинг) подклассам (`JsonExporter`, `CsvImporter`).
5. **Посетитель (Visitor)**:
    - **Где**: `JsonExportVisitor`, `CsvExportVisitor`, `YamlExportVisitor` в связке с `ICoreEntityVisitable`.
    - **Важность**: Позволяет разделить логику форматирования данных для экспорта от структуры сущностей, упрощая добавление новых форматов.
6. **Фабрика (Factory)**:
    - **Где**: `CoreEntitiesFactory`, `CommandFactory`.
    - **Важность**: Централизует создание объектов, обеспечивая валидацию (например, запрет отрицательного `amount` в `Operation`) и единообразие.
7. **Прокси (Proxy)**:
    - **Где**: `CachedRepository<T>`.
    - **Важность**: Добавляет кэширование поверх `InMemoryRepository`, улучшая производительность при чтении данных.

## Дополнительные особенности
- **DI-контейнер**: Использован `Microsoft.Extensions.DependencyInjection` для управления зависимостями.
- **Тесты**: Покрыты основные модули (`Facades`, `Factories`, `Repositories`, `Strategy`) через xUnit.
